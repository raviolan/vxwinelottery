(function(){var r={},y,U={timeout:4,once:!0,title:"name",subtitle:null,api:null,confetti:!0,showbtn:!0,el:"body",fitsize:!0,speed:350,data:{},winners:[],winnerList:[],winnerHistory:[],number:1,_round:0,$el:null},M=0,S={},u,N="<i class='dh-icon dh-icon-dice'>ðŸŽ²<svg><use xlink:href='#dh-dice'/></svg></i>",W="<i class='dh-icon dh-icon-dice'>ðŸ’¾<svg><use xlink:href='#dh-save'/></svg></i>",R="<i class='dh-icon dh-icon-okay'>ðŸ‘Œ<svg><use xlink:href='#dh-okay'/></svg></i>";$(document).keypress(function(t){return t.preventDefault(),!1}),window.onbeforeunload=function(){return!1};var q=function(t){var e=$("      <svg xmlns='http://www.w3.org/2000/svg' style='display: none;'>        <symbol id='dh-okay' viewBox='0 0 57 92'>          <path fill='currentColor' fill-rule='nonzero' d='M3.6 51c2.5-1 5.2.3 6.2 2.7 1.3 3.5 4.6 5.8 8.3 5.8 5 0 9.2-4 9.2-9s-4-9-9-9c-3.8 0-7 2.2-8.4 5.6C8.8 49.7 6 51 3.6 50c-2.4-1-3.6-3.7-2.6-6C3.8 36.4 10.5 32 18 32c3.5 0 6.7 1 9.5 2.5l-8.8-22c-1-2.5.3-5.2 2.7-6.2 2.4-1 5.2.3 6 2.7L37 32.4 33.4 6.2c-.3-2.5 1.5-5 4-5.3 2.7-.4 5 1.4 5.4 4L46 29.7l1-11c.2-2.7 2.5-4.7 5-4.4 2.7.2 4.7 2.5 4.4 5l-3.6 41-4 30.8h-29l4.8-23.3c-2 .8-4.2 1.2-6.5 1.2C10.6 69 4 64.2 1 57c-1-2.4.2-5.2 2.6-6z'/>        </symbol>        <symbol id='dh-crown' viewBox='0 0 88 81'>          <path fill='currentColor' fill-rule='nonzero' d='M83 23c-2.6 0-4.8 2.3-4.8 5 0 1.6.8 3 2 4L69.6 48.2l-4-27.8c2.5-.3 4.3-2.3 4.3-4.7 0-2.7-2.2-4.8-4.8-4.8-2.7 0-4.8 2-4.8 4.8 0 2 1.3 3.8 3 4.4l-8 22-9.8-32c2-.6 3.4-2.4 3.4-4.6C48.8 3 46.6.8 44 .8c-2.6 0-4.8 2.2-4.8 4.8 0 2.2 1.4 4 3.4 4.6l-9.8 32-8-22c1.8-.6 3-2.4 3-4.4 0-2.7-2-4.8-4.7-4.8-2.6 0-4.7 2-4.7 4.8 0 2.4 1.8 4.3 4 4.7l-3.8 27.8-11-16.5c1.4-.8 2.3-2.3 2.3-4C9.8 25.2 7.6 23 5 23 2.4 23 .2 25.2.2 27.8c0 2.7 2.2 4.8 4.8 4.8.4 0 .8 0 1.2-.2l9.7 41s18.6-1.6 28-1.6c9.4 0 28 1.6 28 1.6L82 32.6H83c2.6 0 4.8-2 4.8-4.7s-2.2-5-4.8-5zM26 62.7c-2 0-3.6-1.6-3.6-3.5 0-2 1.6-3.5 3.6-3.5s3.6 1.6 3.6 3.6-1.6 3.6-3.6 3.6zm18 2.2c-3.2 0-5.8-2.5-5.8-5.7 0-3 2.6-5.7 5.8-5.7 3.2 0 5.8 2.6 5.8 5.8 0 3.3-2.6 5.8-5.8 5.8zm18-2.2c-2 0-3.6-1.6-3.6-3.5 0-2 1.6-3.5 3.6-3.5s3.6 1.6 3.6 3.6-1.6 3.6-3.6 3.6z'/>        </symbol>        <symbol id='dh-dice' viewBox='0 0 90 76'>          <path fill='currentColor' fill-rule='nonzero' d='M83.6 34.5c-1-.4-2.2 0-2.6 1-.4 1 0 2.3 1 2.7 4.4 1.7 4 3.2 3.6 4-.5 1.8-5.8 4-12.7 5.3l8.7-15.2c1.7-3 .7-6.7-2.3-8.4L39.7 1c-3-1.8-6.7-.7-8.5 2.2L10.8 38.6c-4.4-1.4-6.6-3-6.6-4 0-2 2.6-4.3 9.8-6 1-.2 1.8-1.3 1.6-2.4-.3-1-1.4-1.8-2.4-1.5C1.8 27.3.2 32 .2 34.5c0 7 14 9.5 21.7 10.4 0-.2 0-.3-.2-.5-.8-3 1-6 4-6.7 2.8-.8 5.8 1 6.6 4 .8 2.8-1 5.8-4 6.6-2 .6-4.3-.3-5.6-2-.5.5-1 .8-1.8.7-5.4-.4-9.8-1.3-13.3-2.4-.6 2.6.5 5.4 3 6.8l38.8 22.4s2.4 1.6 4.2 1.6c1.8 0 3.4-1.6 3.4-1.6.8-.4 1.3-1 1.7-1.8l10-17.2-6.3.3c-1 0-2-.6-2-1.5-.2-.2-.2-.4-.2-.6 9-.3 27-2.8 29.3-9.5 1-2.7.6-6.5-6-9zm-48-13.7c-1-3 1-6 3.8-6.7 3-.7 6 1 6.7 4 1 3-1 6-3.8 6.7-3 .7-6-1-6.7-4zm15 40.3c-3 1-6-.8-6.7-3.7-1-3 1-6 3.8-6.7 3-.8 6 1 6.7 3.8.8 3-1 6-4 6.7zm13.7-23.6c-3 .8-6-1-6.7-4-.8-2.8 1-5.8 4-6.6 2.8-.7 5.8 1 6.6 4 .8 2.8-1 5.8-4 6.6z'/>        </symbol>        <symbol id='dh-save' viewBox='-4 -4 32 32'>          <path fill='currentColor' fill-rule='nonzero' d='M19 11h-14v-2h14v2zm0 2h-14v2h14v-2zm0 4h-14v2h14v-2zm3-11v16h-20v-16h20zm2-6h-24v24h24v-24z'/>        </symbol>      </svg>    "),n=navigator.platform&&(navigator.platform.toLowerCase().indexOf("mac")>=0||/iPad|iPhone|iPod/.test(navigator.platform));y=$("<div class='dh-lottery"+(n?" is-mac":"")+"'></div>");var a=$("<div id='dh-lottery-selector' style='display: none'></div>"),i=$("      <div class='main-container'>        <canvas id='canvas'></canvas>        <div class='userlist columns is-multiline is-mobile'></div>      </div>    "),s=$("      <div class='actions'>        <a class='button primary' id='dh-history-show'>"+W+"</a>        <a class='button primary' id='dh-lottery-go'>"+N+"</a>      </div>    "),c=$("      <div class='dh-modal"+(n?" is-mac":"")+"' id='dh-lottery-winner'>        <div class='dh-modal-background'></div>        <div class='dh-modal-content'></div>        <button class='dh-modal-close'></button>      </div>    "),d=$("<div class='dh-modal-content'></div>");y.append(e),y.append(i),i.append(a),y.append(d),$("#list").append(d),r.showbtn&&y.append(s),t.append(y),t.append(c),$("#dh-lottery-go").click(function(){return x?z():J()}),$("#dh-lottery-winner .dh-modal-close").click(function(){return $("#dh-lottery-winner").removeClass("is-active")}),$("#dh-lottery-history .dh-history-clean").click(function(){L()}),$("#dh-lottery-history .dh-number-inc").click(function(){r.number<10&&(r.number+=1,localStorage.setItem("lotteryConfigNumber",r.number),$("#dh-lottery-history .dh-number").text(r.number))}),$("#dh-lottery-history .dh-number").click(function(){r.number=1,localStorage.setItem("lotteryConfigNumber",r.number),$("#dh-lottery-history .dh-number").text(r.number)}),$("#dh-lottery-history .dh-number-dec").click(function(){r.number>1&&(r.number-=1,localStorage.setItem("lotteryConfigNumber",r.number),$("#dh-lottery-history .dh-number").text(r.number))}),$("#dh-history-show").click(function(){b(),$("#dh-lottery-history .dh-number").text(r.number)}),document.body.onkeydown=function(l){if(l.keyCode==27)return $(".dh-modal-close").click();if(l.keyCode==32)return $("#dh-lottery-winner").hasClass("is-active")||$(".lotterybox").hasClass("running-lottery")?void 0:$("#dh-lottery-go").click();if(l.key=="d"&&confirm("Vill du rensa dragna platser?")){L();return}},b()},G=function(){for(var t="",e=0;e<r.number;e++){var n="        <span class='image' id='selector_"+e+"'>          <div class='selector-border'></div>        </span>      ";t=t+n}$("#dh-lottery-selector").html(t),setTimeout(function(){g=k(),$("#dh-lottery-selector .image").show();for(var a=0;a<r.number;a++)w(a,0)},1e3),r.fitsize&&p(u)},C=function(t,e){var n={name:function(a){return a}};return e.replace(/\{(\w+)\}/g,function(a,i){return i?n&&n[i]?n[i](t[i]):t[i]:""})},V=function(t){var e="      <div class='column'>        <div class='profile' data-profile='{json}'>            <div class='profile__parent'>                <div class='profile__wrapper'>                    <div class='profile__content'>                        <div class='avatar'><span class='image avatar-image is-128x128'><img src='{avatar}' alt='avatar'/></span></div>                    </div>                </div>            </div>        </div>      </div>    ";t.json=encodeURIComponent(JSON.stringify(t));var n=C(t,e);return $(".userlist").append(n)},F=function(){$.ajax({type:"GET",url:r.api,dataType:"json",success:function(t){r.data=t,A()},error:function(t,e){alert(`Lottery: Load player list error!
`+e+`
`+e)}})},K=function(t){for(var e=r.winnerHistory.length;e--;)for(var n in r.winnerHistory[e].winner)if(r.winnerHistory[e].winner[n].avatar===t)return!0;return!1},A=function(){if(r.$el=$(r.el),localStorage.getItem("lotteryHistory")&&(r.winnerHistory=JSON.parse(localStorage.getItem("lotteryHistory"))),M=r.data.length,r.winnerHistory)for(var t=r.data.length;t--;)K(r.data[t].avatar)&&r.data.splice(t,1);q(r.$el),$.each(r.data,function(e,n){n.id=e,V(n)}),r.fitsize&&O(),r.confetti&&window.readyConfetti()},O=function(){var t=$(".main-container"),e=$(".userlist"),n=t.height()*t.width(),a=r.data.length||1;u=Math.max(10,Math.round(Math.sqrt(n/a)/1.15)),p(u);for(var i=0;e.outerHeight()<=t.height()&&e.outerWidth()<=t.width()&&i<400;){var s=u;if(u+=2,p(u),i++,e.outerHeight()>t.height()||e.outerWidth()>t.width()){u=s,p(u);break}}for(i=0;(e.outerHeight()>t.height()||e.outerWidth()>t.width())&&i<200&&!(u<=10);)u-=2,p(u),i++;k()},p=function(t){$(".dh-lottery .avatar .image").css("height",t+"px"),$(".dh-lottery .avatar .image").css("width",t+"px"),$("#dh-lottery-selector .image").css("height",t+"px"),$("#dh-lottery-selector .image").css("width",t+"px")},g=[],f=[],x=null,B=null;$(window).resize(function(){g=k();for(var t in f)w(t,f[t]);r.fitsize&&O()});var k=function(){return $.map($(".profile"),function(t,e){return S[e]=t,$(t).find(".avatar-image").first().position()})},D=function(t){var e=0;for(var n in t)e++;return e},Q=function(t){var e=$("          <div class='winner-stage'>            <div class='winner-lights'></div>            <div class='winner-center'>              <div class='winner-giftbox'></div>              <div class='winner-butterflies'></div>              <img class='winner-portrait' src='' alt='winner' />            </div>            <div class='winner-text'>              <h2 class='profile-name'></h2>              <h3 class='profile-subtitle'></h3>              <h4 class='profile-desc'></h4>            </div>          </div>        "),n,a,i;t&&(e.find(".winner-portrait").attr("src",t.avatar),t.data&&Object.keys(t.data).length>0&&(a=t.data[r.title],n=t.data[r.subtitle],i=t.data[r.desc]),e.find(".profile-name").text(a||t.name),e.find(".profile-subtitle").text(n||t.company),e.find(".profile-desc").text(i||"")),$("#dh-lottery-winner .dh-modal-content").append(e);try{var s=window.lottie;if(s){var c=function(l){var v=/(kurage|watermark|website|mobile|apps|software|lottiefiles|author|credits)/i;function m(o){var I=o&&o.nm?String(o.nm):"";return!!(o.ty===5||v.test(I)||o.t)}function h(o){return o.layers&&Array.isArray(o.layers)&&(o.layers=o.layers.filter(function(I){return!m(I)}),o.layers.forEach(h)),o.assets&&Array.isArray(o.assets)&&o.assets.forEach(h),o}try{return h(l)}catch{return l}},d=function(l,v,m){return fetch(l).then(function(h){return h.json()}).then(function(h){var o=c(h);return s.loadAnimation(Object.assign({container:v,renderer:"svg",autoplay:!0},m||{},{animationData:o}))})};d("/assets/lottie/lights-purple.json",e.find(".winner-lights")[0],{loop:!0}),d("/assets/lottie/gift-box.json",e.find(".winner-giftbox")[0],{loop:!1}).then(function(l){try{l.addEventListener("complete",function(){e.find(".winner-portrait").addClass("is-revealed"),e.find(".winner-giftbox").css("display","none")})}catch{}}),setTimeout(function(){d("/assets/lottie/butterflies-magenta.json",e.find(".winner-butterflies")[0],{loop:!1})},400)}}catch{}setTimeout(function(){e.find(".winner-portrait").hasClass("is-revealed")||(e.find(".winner-portrait").addClass("is-revealed"),e.find(".winner-giftbox").css("display","none"))},1500)},w=function(t,e){if($(S[e]).addClass("current"),!!g[e]){var n=g[e],a=$("#dh-lottery-selector #selector_"+t);return a.css({transition:"left 200ms ease-in-out, top 200ms ease-in-out",left:n.left-4+"px",top:n.top-4+"px"}),f}},E=function(){var t=[];return $(".profile").each(function(e,n){try{var a=JSON.parse(decodeURIComponent($(n).data("profile"))),i=a&&a.id,s=$(n).hasClass("is-greyed");(!r.once||!r.winnerList[i])&&(s||t.push(e))}catch{t.push(e)}}),t},H=function(t=0){if(!(g<=0)){var e=E();if(e.length!==0){var n=e[Math.floor(Math.random()*e.length)];if($.inArray(n,f)>=0)return H(t);w(t,n),f.push(n)}}},_=null,J=function(){if(G(),r.once&&$(".profile").length-D(r.winnerList)<r.number)return alert("No user left to participate in lottery."),!1;r.$el.addClass("running-lottery"),$("#dh-lottery-selector").show();var t=function(){f=[],$(".dh-lottery .profile.current").removeClass("current");for(var e=0;e<r.number;e++)H(e);var n=Math.max(60,Math.round((Math.random()*.8+.2)*r.speed));_=setTimeout(t,n)};return t(),r.timeout&&(B=setTimeout(z,r.timeout*1e3)),$("#dh-lottery-go").removeClass("primary").addClass("success").html(R),!0},X=function(){b()},z=function(){r.$el.removeClass("running-lottery"),clearTimeout(B),clearTimeout(_),$("#dh-lottery-winner .dh-modal-content").html(""),r.winners=[];for(var t=E(),e=[],n=0;n<r.number&&t.length!==0;n++){var a=Math.floor(Math.random()*t.length);e.push(t[a]),t.splice(a,1)}for(var i=5+Math.floor(Math.random()*5),s=0;s<i;s++)setTimeout(function(){$(".dh-lottery .profile.current").removeClass("current");for(var c=0;c<r.number;c++)H(c)},s*(120+Math.random()*120));setTimeout(function(){$(".dh-lottery .profile.current").removeClass("current"),f=[];for(var c=0;c<e.length;c++)w(c,e[c]),f.push(e[c]);for(var d=0;d<f.length;d++){var l=JSON.parse(decodeURIComponent($($(".profile")[f[d]]).data("profile"))),v=l.id;r.winners.push(l),r.once&&(r.winnerList[v]=!0),$($(".profile")[f[d]]).addClass("is-greyed"),Q(l)}if($("#dh-lottery-winner").addClass("is-active"),$(".lotterybox").removeClass("running-lottery"),clearInterval(x),x=null,r.confetti&&window.startConfetti(),window.heartsBurst)try{window.heartsBurst()}catch{}setTimeout(function(){return window.stopConfetti()},2e3),setTimeout(function(){$("#dh-lottery-go").removeClass("success").addClass("primary").html(N)},500);var m={};m.time=new Date().toLocaleString(),m.winner={};for(var h in r.winners)m.winner[h]=r.winners[h];return r.winnerHistory.push(m),localStorage.setItem("lotteryHistory",JSON.stringify(r.winnerHistory)),X(),l},i*140+220)},L=function(){return confirm("Delete Lottery History. Sure?")==!0?(localStorage.setItem("lotteryHistory",""),r.winnerHistory=[],$("#dh-lottery-history").html(""),!0):!1},b=function(){var t=r.winnerHistory,e="      <div class='dh-history-item'>        <div class='dh-history-info'>          <h3 class='place'>{i}. <span class='dh-history-user'></span></h3>        </div>      </div>    ",n="<span>{name}</span>",a=$("#dh-lottery-history");a.html("");for(var i in t){var s=t[i];s.number=D(s.winner),s.i=M-Number(i);var c=$(C(s,e));for(var d in s.winner){var l=t[i].winner[d],v=$(C(l,n));c.find(".dh-history-user").append(v)}a.prepend(c)}return r.winnerHistory},T={init:function(t){r=$.extend({},U,t),r.api!=null?F(r.api):A(),!t.number&&localStorage.lotteryConfigNumber&&(r.number=parseInt(localStorage.lotteryConfigNumber)||1)},start:function(){return J()},stop:function(){return z()},getUsers:function(){return r.data},winners:function(t){switch(t){case"get":return r.winners;case"clean":return r.winnerList=[],!0;default:console.error("Action "+t+" does not exist.");break}},history:function(t){switch(t){case"show":return b();case"get":return r.winnerHistory;case"clean":return L();default:console.error("Action "+t+" does not exist.");break}}};$.lottery=function(t){if(T[t])return T[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return T.init.apply(this,arguments);console.error("Method "+t+" does not exist.")}})();
